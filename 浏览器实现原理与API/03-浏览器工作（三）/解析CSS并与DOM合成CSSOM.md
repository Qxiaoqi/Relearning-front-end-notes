# 12-浏览器：一个浏览器是如何工作的？（阶段三）

这一部分涉及到的内容是在上一节构建DOM树的过程中来进行的进一步操作。主要讲解了浏览器是如何把CSS规则应用到节点上，并给DOM树添加上CSS属性，形成CSSOM的过程。看完之后更想自己写一个简单的浏览器了。

## 整体过程

CSS规则并不是等DOM树构建好才开始添加的，而是在DOM树构建的过程中同步计算的。DOM树的构建过程是从父到子，从先到后，一个一个节点构造，浏览器会尽量流式处理整个过程。也因此是在DOM树构建的过程中，检测它匹配到了哪些规则，再根据规则的优先级，做覆盖和调整。因此CSS选择器被理解成匹配器更合适一点。

CSS的选择器符号
* 空格：后代，选中子节点和所有子节点的后代节点
* >：子代，选中它的子节点，子节点的子节点不会被选中
* +：直接后继选择器，选中它的下一个相邻节点，必须相邻，而且子代的子代不会被选中
* ~：后继，选中它之后的所有相邻节点

## 空格

当满足一个条件时，前进一段。还需要处理后退的情况，即遇到标签闭合情况要回退一步。

## 后继选择器`~`

后继选择器只作用于同一层，因此同层内的其它子代选择器就不应被选中。思路是给选择器的激活，带上一个条件：父元素。只有父元素相同的时候，才会被匹配，因此同层内的其它子代选择器就不会被选中。

## 子代选择器`>`

按照后继选择器的思路来想，基本上一致。不同之处，就是子代选择器按照当前节点作为父节点。

## 直接后继选择器`+`

仅对唯一一个元素生效，直接当作检查元素自身的选择器来处理

## 其他情况

### 逗号`,`

可将其当成两条规则来处理

### 重合

使用树形结构来合并，提高效率